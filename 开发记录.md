# 国信合创 - 开发记录

> 本文档整合了项目历次功能开发的完整记录，按时间倒序排列。

---

## 目录

- [1. 功能简化重构（2026-01-23）](#1-功能简化重构)
- [2. 最新动态 & 常见问题管理（初始版本）](#2-最新动态--常见问题管理)
- [3. 实战战报统计管理（初始版本）](#3-实战战报统计管理)

---

## 1. 功能简化重构

**日期**: 2026-01-23
**分支**: `claude/simplify-management-features-xQ1IK`

### 1.1 修改背景

原有的三个功能（战报统计、最新动态、常见问题）采用了完整的 MVC 分层架构，包括独立的数据库表、Model、DAO、Services 层。这种设计过于复杂，维护成本较高。

### 1.2 简化方案

改用系统配置表 `system_config` 存储 JSON 数据，与系统"设置"功能保持一致的设计模式。

### 1.3 修改效果

| 指标 | 修改前 | 修改后 |
|------|--------|--------|
| 代码行数 | ~1618 行 | ~825 行 |
| 文件数量 | 17 个 | 6 个 |
| 数据库表 | 3 个独立表 | 复用 system_config |
| 架构层级 | Controller -> Services -> DAO -> Model | Controller 直接操作 |

### 1.4 删除的文件清单（11个）

**Model 层（3个）:**

| 文件路径 | 说明 |
|----------|------|
| `app/model/gxhc/BattleStats.php` | 战报统计数据模型 |
| `app/model/gxhc/News.php` | 最新动态数据模型 |
| `app/model/gxhc/Faq.php` | 常见问题数据模型 |

**DAO 层（3个）:**

| 文件路径 | 说明 |
|----------|------|
| `app/dao/gxhc/BattleStatsDao.php` | 战报统计数据访问层 |
| `app/dao/gxhc/NewsDao.php` | 最新动态数据访问层 |
| `app/dao/gxhc/FaqDao.php` | 常见问题数据访问层 |

**Services 层（3个）:**

| 文件路径 | 说明 |
|----------|------|
| `app/services/gxhc/BattleStatsServices.php` | 战报统计业务逻辑层 |
| `app/services/gxhc/NewsServices.php` | 最新动态业务逻辑层 |
| `app/services/gxhc/FaqServices.php` | 常见问题业务逻辑层 |

**SQL 迁移文件（2个）:**

| 文件路径 | 说明 |
|----------|------|
| `public/install/battle_stats.sql` | 战报统计表结构 |
| `public/install/news_and_faq.sql` | 最新动态和常见问题表结构 |

### 1.5 修改的文件清单（6个）

**后台管理控制器（3个）:**

- `app/adminapi/controller/v1/gxhc/BattleStats.php` - 移除 Services 依赖，改用 SystemConfigServices
- `app/adminapi/controller/v1/gxhc/News.php` - 移除 Services 依赖，改用 SystemConfigServices
- `app/adminapi/controller/v1/gxhc/Faq.php` - 移除 Services 依赖，改用 SystemConfigServices

**前端 API 控制器（3个）:**

- `app/api/controller/v1/gxhc/BattleStatsController.php` - 改用 `sys_config()` 读取
- `app/api/controller/v1/gxhc/NewsController.php` - 改用 `sys_config()` 读取
- `app/api/controller/v1/gxhc/FaqController.php` - 改用 `sys_config()` 读取

### 1.6 数据存储格式

三个功能的数据分别存储在 `eb_system_config` 表中：

- `gxhc_battle_stats` - 战报统计 JSON 数组
- `gxhc_news` - 最新动态 JSON 数组
- `gxhc_faq` - 常见问题 JSON 数组

**数据库初始化 SQL：**

```sql
INSERT INTO `eb_system_config` (`menu_name`, `type`, `config_tab_id`, `value`, `status`) VALUES
('gxhc_battle_stats', 'text', 0, '[]', 1),
('gxhc_news', 'text', 0, '[]', 1),
('gxhc_faq', 'text', 0, '[]', 1);
```

### 1.7 注意事项

- API 接口完全兼容，前端调用方式无需修改
- 修改配置后会自动清理缓存（`CacheService::clear()`）
- 如已有旧数据，需手动迁移到新的 JSON 格式

---

## 2. 最新动态 & 常见问题管理

**分支**: 初始开发阶段

### 2.1 功能概述

后台管理系统中动态管理小程序的"最新动态"和"常见问题"内容，实现内容的实时更新。

### 2.2 功能特性

**最新动态管理:**
- 支持两种类型：动态（news）和精华（featured）
- 自动计算相对时间（刚才、2小时前、1天前等）
- 支持封面图片、作者、排序
- 浏览次数统计
- 发布时间控制、状态启用/禁用

**常见问题管理:**
- 问题分类管理
- 问答内容编辑
- 查看次数统计
- 排序功能、状态启用/禁用

### 2.3 后台管理接口

**最新动态：**

| 方法 | 路由 | 功能 |
|------|------|------|
| GET | `/adminapi/news/list` | 获取列表（支持分页、筛选） |
| GET | `/adminapi/news/all` | 获取所有启用动态 |
| GET | `/adminapi/news/detail/:id` | 获取详情 |
| POST | `/adminapi/news/create` | 创建动态 |
| PUT | `/adminapi/news/update/:id` | 更新动态 |
| DELETE | `/adminapi/news/delete/:id` | 删除动态 |
| PUT | `/adminapi/news/set_status/:id` | 修改状态 |

**常见问题：**

| 方法 | 路由 | 功能 |
|------|------|------|
| GET | `/adminapi/faq/list` | 获取列表（支持分页、筛选） |
| GET | `/adminapi/faq/all` | 获取所有启用问题 |
| GET | `/adminapi/faq/categories` | 获取所有分类 |
| GET | `/adminapi/faq/detail/:id` | 获取详情 |
| POST | `/adminapi/faq/create` | 创建问题 |
| PUT | `/adminapi/faq/update/:id` | 更新问题 |
| DELETE | `/adminapi/faq/delete/:id` | 删除问题 |
| PUT | `/adminapi/faq/set_status/:id` | 修改状态 |

### 2.4 前端 API 接口

**最新动态：**

| 方法 | 路由 | 功能 |
|------|------|------|
| GET | `/api/news/list` | 获取最新动态列表 |
| GET | `/api/news/featured` | 获取精华动态 |
| GET | `/api/news/detail/:id` | 获取动态详情 |

**常见问题：**

| 方法 | 路由 | 功能 |
|------|------|------|
| GET | `/api/faq/list` | 获取常见问题列表 |
| GET | `/api/faq/categories` | 获取所有分类 |
| GET | `/api/faq/detail/:id` | 获取问题详情 |

### 2.5 相对时间计算规则

| 时间差 | 显示格式 |
|--------|----------|
| < 1分钟 | 刚才 |
| < 1小时 | X分钟前 |
| < 1天 | X小时前 |
| < 30天 | X天前 |
| > 30天 | X个月前 |

### 2.6 数据库表结构

**最新动态表（eb_g_news）:**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | int | 主键ID |
| title | varchar(255) | 标题 |
| content | text | 内容 |
| author | varchar(100) | 作者/来源 |
| type | varchar(50) | 类型：news/featured |
| cover_image | varchar(500) | 封面图片URL |
| sort | int | 排序 |
| view_count | int | 浏览次数 |
| status | tinyint | 状态：0=禁用，1=启用 |
| publish_time | int | 发布时间戳 |
| add_time | int | 创建时间戳 |
| update_time | int | 更新时间戳 |

**常见问题表（eb_g_faq）:**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | int | 主键ID |
| question | varchar(500) | 问题 |
| answer | text | 答案 |
| category | varchar(100) | 分类 |
| sort | int | 排序 |
| view_count | int | 查看次数 |
| status | tinyint | 状态：0=禁用，1=启用 |
| add_time | int | 创建时间戳 |
| update_time | int | 更新时间戳 |

> 注：简化重构后，上述两张表已废弃，数据改存 `system_config` 表中。

---

## 3. 实战战报统计管理

**分支**: 初始开发阶段

### 3.1 功能概述

在后台管理系统中动态管理实战战报的统计数据（如320个创业者、45位导师、580份报告等），无需在代码中硬编码数字。

### 3.2 功能特性

- 后台管理界面：增删改查统计项
- 动态更新数值：随时修改统计数字
- 前端API接口：小程序/H5可调用获取最新数据
- 排序功能：自定义展示顺序
- 状态控制：可启用/禁用统计项

### 3.3 后台管理接口

| 方法 | 路由 | 功能 |
|------|------|------|
| GET | `/adminapi/battle_stats/list` | 获取列表 |
| GET | `/adminapi/battle_stats/all` | 获取所有启用项 |
| GET | `/adminapi/battle_stats/detail/:id` | 获取详情 |
| POST | `/adminapi/battle_stats/create` | 创建统计项 |
| PUT | `/adminapi/battle_stats/update/:id` | 更新统计项 |
| DELETE | `/adminapi/battle_stats/delete/:id` | 删除统计项 |
| PUT | `/adminapi/battle_stats/update_value/:id` | 快捷更新值 |
| PUT | `/adminapi/battle_stats/set_status/:id` | 修改状态 |

### 3.4 前端 API 接口

| 方法 | 路由 | 功能 |
|------|------|------|
| GET | `/api/battle_stats/list` | 获取战报统计数据 |
| GET | `/api/battle_stats/get/:key` | 根据key获取单项 |

### 3.5 数据库表结构

**战报统计表（eb_g_battle_stats）:**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | int | 主键ID |
| key | varchar(50) | 统计项唯一标识 |
| name | varchar(100) | 统计项名称 |
| value | int | 统计数值 |
| unit | varchar(20) | 单位（个、位、份、家等） |
| description | varchar(255) | 描述说明 |
| sort | int | 排序 |
| icon | varchar(255) | 图标路径 |
| status | tinyint | 状态：0=禁用，1=启用 |
| add_time | int | 创建时间戳 |
| update_time | int | 更新时间戳 |

**初始数据：**

| key | name | value | unit |
|-----|------|-------|------|
| entrepreneurs | 创业者提交诊断 | 320 | 个 |
| mentors | 导师深度伴用 | 45 | 位 |
| reports | AI诊断报告生成 | 580 | 份 |
| partners | 生态合作伙伴 | 8 | 家 |

> 注：简化重构后，该表已废弃，数据改存 `system_config` 表中（配置项 `gxhc_battle_stats`）。

---

*文档整合时间：2026-01-26*
